<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<?asciidoc-toc?>
<?asciidoc-numbered?>

<article lang="en">
<articleinfo>
    <title>Dépannage</title>
</articleinfo>
<variablelist>
<varlistentry>
<term>
J&#8217;ai une page blanche
</term>
<listitem>
<simpara>
Il faut se connecter en SSH à jeedom et lancer un script d&#8217;auto-diagnostic :
</simpara>
</listitem>
</varlistentry>
</variablelist>
<programlisting language="bash" linenumbering="unnumbered">sudo chmod +x /usr/share/nginx/www/jeedom/health.sh;sudo /usr/share/nginx/www/jeedom/health.sh</programlisting>
<simpara>Voila le résultat si tout est bon :</simpara>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="../images/depannage.png"/>
  </imageobject>
  <textobject><phrase>../images/depannage.png</phrase></textobject>
</mediaobject>
</informalfigure>
<simpara>S&#8217;il y a un souci, le script essaie de corriger, s&#8217;il n&#8217;y arrive pas il vous l&#8217;indiquera.</simpara>
<simpara>Vous pouvez aussi regarder le log /usr/share/nginx/www/jeedom/log/nginx.error, très souvent celui-ci indique le souci</simpara>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
J&#8217;ai un problème d&#8217;identifiant BDD
</term>
<listitem>
<simpara>
Il faut réinitialiser ceux-ci
</simpara>
</listitem>
</varlistentry>
</variablelist>
<programlisting language="bash" linenumbering="unnumbered">bdd_password=$(cat /dev/urandom | tr -cd 'a-f0-9' | head -c 15)
echo "DROP USER 'jeedom'@'localhost'" | mysql -uroot -p
echo "CREATE USER 'jeedom'@'localhost' IDENTIFIED BY '${bdd_password}';" | mysql -uroot -p
echo "GRANT ALL PRIVILEGES ON jeedom.* TO 'jeedom'@'localhost';" | mysql -uroot -p
cd /usr/share/nginx/www/jeedom
sudo cp core/config/common.config.sample.php core/config/common.config.php
sudo sed -i -e "s/#PASSWORD#/${bdd_password}/g" core/config/common.config.php
sudo chown www-data:www-data core/config/common.config.php</programlisting>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
J&#8217;ai des {{&#8230;}} partout
</term>
<listitem>
<simpara>
La cause la plus fréquente est l&#8217;utilisation d&#8217;un plugin en version beta, et Jeedom en stable, ou l&#8217;inverse
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Lors d&#8217;une commande j&#8217;ai une roue qui tourne sans s&#8217;arrêter
</term>
<listitem>
<simpara>
Encore une fois cela est souvent dû à un plugin en beta alors que Jeedom est en stable
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Je n&#8217;ai plus accès à Jeedom ni en SSH
</term>
<listitem>
<simpara>
Cette erreur n&#8217;est pas due à Jeedom mais à un problème avec le système.
Si celui-ci persiste suite à une réinstallation il est conseillé de voir avec le SAV pour un souci hardware
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Mon scénario ne s&#8217;arrête plus/pas
</term>
<listitem>
<simpara>
Il est conseillé de regarder les commandes exécutées par le scénario,
souvent cela vient d&#8217;une commande qui ne se termine pas
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Mon scénario est lent à se déclencher
</term>
<listitem>
<simpara>
Si dans le scénario il n&#8217;y a pas de pause il est conseillé de cocher la case "éxécuter le plus rapidement possible" (disponible en mode expert)
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Je n&#8217;ai aucune erreur dans le log nginx.error malgrè des erreurs 500
</term>
<listitem>
<simpara>
En ssh :
Editez le fichier /etc/php5/fpm/pool.d/www.conf et décommantez la ligne ";catch_worket_process=yes" (supression du ;)
et redémarrez php "sudo service php5-fpm restart"
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
J&#8217;ai des instabilités ou des erreurs 504
</term>
<listitem>
<simpara>
Vérifiez si votre système de fichiers n&#8217;est pas corrompu, en ssh la commande est : "sudo dmesg | grep error"
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Je ne vois pas tous mes équipements sur le dashboard
</term>
<listitem>
<simpara>
Souvent cela est dû au fait que les équipements sont affectés à un objet qui n&#8217;est pas le fils ou
l&#8217;objet lui-même du premier objet sélectionné à gauche dans l&#8217;arbre (vous pouvez dans votre profil configurer celui-ci)
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Lors de la connexion du maître avec les esclaves j&#8217;ai des erreurs
</term>
<listitem>
<simpara>
Vérifiez que vous avez bien mis les /jeedom si vous utilisez ceux-ci juste après l&#8217;IP de jeedom
(souvent le cas en installation DIY)
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
J&#8217;ai l&#8217;erreur suivante : SQLSTATE[HY000] [2002] Can&#8217;t connect to local MySQL server through socket <emphasis>/var/run/mysqld/mysqld.sock</emphasis>
</term>
<listitem>
<simpara>
Cela est dû à MySQL qui s&#8217;est arrêté, ce n&#8217;est pas normal, les cas courants sont :
</simpara>
<itemizedlist>
<listitem>
<simpara>
souci de place sur le système de fichiers (peut être vérifié en faisant la commande "df -h", en ssh)
</simpara>
</listitem>
<listitem>
<simpara>
problème de corruption de fichier(s), arrive souvent suite à un arrêt non propre de Jeedom (coupure de courant)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<simpara>Malheureusement, il n&#8217;y a pas beaucoup de solution si c&#8217;est le deuxième cas,
le mieux étant de récupérer un backup (disponible dans /usr/share/nginx/www/jeedom/backup par défaut),
de réinstaller Jeedom et de restaurer le backup.
Vous pouvez aussi en ssh regarder pourquoi mysql ne veut pas démarrer :</simpara>
<programlisting language="bash" linenumbering="unnumbered">sudo su -
service mysql stop
mysqld --verbose</programlisting>
<simpara>Ou consulter le log : /var/log/mysql/error.log</simpara>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
Les boutons Eteindre/Redémarrer ne fonctionnent pas
</term>
<listitem>
<simpara>
Sur une installation DIY c&#8217;est normal, il faut faire en ssh la commande visudo et à la fin du fichier
vous devez ajouter : www-data ALL=(ALL) NOPASSWD: ALL.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><?asciidoc-hr?></simpara>
<variablelist>
<varlistentry>
<term>
J&#8217;ai souvent des "502 bad gateway"
</term>
<listitem>
<simpara>
Il faut aller (en mode expert) dans la configuration de Jeedom, puis Système OS et cliquer sur Lancer. Là vous cliquez sur "PHP log", si vous avez le message "server reached pm.max_clidren", c&#8217;est qu&#8217;il manque des processus php fpm, il faut donc en autoriser plus. Pour cela faire :
</simpara>
</listitem>
</varlistentry>
</variablelist>
<programlisting language="bash" linenumbering="unnumbered">sudo su -
cd /etc/php5/fpm/pool.d/
vim www.conf</programlisting>
<simpara>Editer la ligne "pm.max_children" en mettant "pm.max_children = 20"</simpara>
<simpara>Ensuite il suffit de redémarrer php5-fpm</simpara>
<programlisting language="bash" linenumbering="unnumbered">sudo service php5-fpm restart</programlisting>
<variablelist>
<varlistentry>
<term>
Je ne vois pas certains plugins du Market 
</term>
<listitem>
<simpara>
Ce genre de cas arrive si votre Jeedom n&#8217;est pas compatible avec le plugin, en général une mise à jour de jeedom corrige le souci
</simpara>
</listitem>
</varlistentry>
</variablelist>
</article>
